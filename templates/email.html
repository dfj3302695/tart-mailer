<!doctype html>

<form method="POST" action="">
    <table>
        <tr>
            <td>From Name:</td>
            <td>
                <input type="text" name="fromname" maxlength="200" value="{{ email.fromname }}" required {{ 'disabled ' if not email.draft }}/>
            </td>
        </tr>
        <tr>
            <td>From Address:</td>
            <td>
                <input type="text" name="fromaddress" maxlength="200" value="{{ email.fromaddress }}" required {{ 'disabled ' if not email.draft }}/>
            </td>
        </tr>
        <tr>
            <td>Subject:</td>
            <td>
                <input type="text" name="subject" maxlength="1000" value="{{ email.subject }}" required {{ 'disabled ' if not email.draft }}/>
            </td>
        </tr>
        <tr>
            <td>Plain Text Body:</td>
            <td>
                <textarea name="plainbody" {{ 'disabled ' if not email.draft }}>{{ email.plainbody }}</textarea>
            <td>
        </tr>
        <tr>
            <td>HTML Body:</td>
            <td>
                <textarea name="htmlbody" {{ 'disabled ' if not email.draft }}>{{ email.htmlbody }}</textarea>
            </td>
        </tr>
        <tr>
            <td>Return URL Root:</td>
            <td>
                <input type="text" name="returnurlroot" maxlength="1000" value="{{ email.returnurlroot }}" {{ 'disabled ' if not email.draft }}/>
            </td>
        </tr>
        <tr>
            <td>Redirect URL:</td>
            <td>
                <input type="text" name="redirecturl" maxlength="1000" value="{{ email.redirecturl }}" {{ 'disabled ' if not email.draft }}/>
            </td>
        </tr>
{% if exampleproperties %}
        <tr>
            <td>Example Properies:</td>
            <td>{{ exampleproperties }}</td>
        </tr>
{% endif %}
    </table>

    <p>Properties can be used as {property} in addition to {unsubscribeurl}, {redirecturl}, {trackerimageurl} inside the subject, plain text body or HTML body.</p>

{% if action == 'save' %}
    <strong>{{ message }}</strong>
{% endif %}

    <p>
        <input type="hidden" name="emailid" value="{{ email.id }}" />
        <input type="hidden" name="draft" value="{{ email.draft }}" />
        <input type="submit" name"submit" value="Save" {{ 'disabled ' if not email.draft }}/>
    </p>
</form>

{% if email.id %}
<form method="POST" action="sendTest">
    <table>
        <tr>
            <td>Email Address:</td>
            <td>
                <input type="text" name="subscriberemailaddress" maxlength="200" required {{ 'disabled ' if not email.draft }}/>
            </td>
        </tr>
    </table>

{% if action == 'sendTest' %}
    <strong>{{ message }}</strong>
{% endif %}

    <p>
        <input type="hidden" name="emailid" value="{{ email.id }}" />
        <input type="submit" name"submit" value="Send Test Email" {{ 'disabled ' if not email.draft }}/>
    </p>
</form>

<form method="POST" action="removeTest">
{% if action == 'removeTest' %}
    <strong>{{ message }}</strong>
{% endif %}

    <p>
        <input type="hidden" name="emailid" value="{{ email.id }}" />
        <input type="submit" name"submit" value="Remove Send Test Emails" {{ 'disabled ' if not email.draft }}/>
    </p>
</form>

<form method="POST" action="send">
    <table border="1">
        <tr>
            <th></th>
            <th>Locale</th>
            <th>Send</th>
            <th>Total</th>
        </tr>
    {% for stat in subscriberlocalestats %}
        <tr>
            <td>
                <input type="checkbox" name="locales[]" value="{{ stat.locale }}" {{ 'disabled ' if stat.sendcount == stat.count }}/>
             </td>
            <td>{{ stat.locale }}</td>
            <td>{{ stat.sendcount }}</td>
            <td>{{ stat.count }}</td>
        </tr>
    {% endfor %}
    </table>

    <table>
        <tr>
            <td>Maximum Subscriber Count:</td>
            <td>
                <input type="text" name="subscribercount" maxlength="20" value="{{ subscribercount }}" required {{ 'disabled ' if subscribercount == 0 }}/>
            </td>
        </tr>
    </table>

    <p>Counts does not include unsubscribed or complained subscribers. Emails may have been sent to them before.</p>

    <p>Review all fields carrefully before sending. Write the Return URL Root and the Redirect URL to your browser. Check that they return 200.</p>

    <p>The current subscribers will be added to the queue. Emails will be send asynchronously. Adding many emails to the queue can take minutes.<p>

    {% if action == 'send' %}
    <strong>{{ message }}</strong>
    {% endif %}

    <p>
        <input type="hidden" name="emailid" value="{{ email.id }}" />
        <input type="submit" name"submit" value="Send" {{ 'disabled ' if subscribercount == 0 }}/>
    </p>
</form>
{% endif %}

<p>
    <a href="{{ url_for('listEmails') }}" >List Emails</a>
</p>

<p>
    <a href="{{ url_for('newEmail') }}" >New Email</a>
</p>

